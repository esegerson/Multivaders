<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multivaders</title>
    <script src="game.js"></script>
    <script src="music.js"></script>
    <link rel="stylesheet" href="game.css" />
</head>
<body>
    <div id="gameTitle">
        <h1>Multivaders!</h1>
        <p>Multivaders is a thrilling space shooter game where you defend your planet from waves of alien invaders. Solve multiplication problems to defeat the enemies!</p>
        <p>Select what multiplication facts you'd like to work with:</p>
        <p id="presetButtons">Presets: 
            <button class="hardcoded" onclick="preset(1)" onmouseover="hoverPreset(this)" onmouseout="clearHoverPreset()">Set A</button> 
            <button class="hardcoded" onclick="preset(2)" onmouseover="hoverPreset(this)" onmouseout="clearHoverPreset()">Set B</button>
            <button class="hardcoded" onclick="preset(3)" onmouseover="hoverPreset(this)" onmouseout="clearHoverPreset()">Set C</button>
            <button class="hardcoded" onclick="preset(4)" onmouseover="hoverPreset(this)" onmouseout="clearHoverPreset()">Set D</button>
            <button class="hardcoded" onclick="preset(5)" onmouseover="hoverPreset(this)" onmouseout="clearHoverPreset()">Set E</button>
            <span id="presetList"></span>
            <span class="savePresetContainer">
                <button id="btnMakePreset" disabled onclick="openPresetModal()" title="Select a fact to create a preset">&plus; Make Preset</button>
                <span id="presetSave" style="display: none;">
                    <input type="text" id="setname" placeholder="Preset Name" maxlength="20"/>
                    <button onclick="savePreset()" title="Save Preset">&#x2714;</button>
                    <button onclick="closeNewPresetUi()" title="Cancel">&#x2716;</button>
                </span>
            </span>
            <button id="btnDeletePreset" disabled onclick="deletePreset(this)" title="No custom presets to delete">&minus; Delete Preset</button>
            <button id="btnClear" disabled onclick="clearSelection()" title="No facts to clear">Clear</button>
        </p>
        <div class="grid">
            <!-- Generate 12x12 buttons -->
            <script>
                const maxFactor = 12;
                const gridContainer = document.querySelector('.grid');
                for (let i = 0; i <= maxFactor; i++)
                    for (let j = 0; j <= maxFactor; j++) {
                        const button = document.createElement('button');
                        button.textContent = i + " \u00d7 " + j; // Display the product of i and j
                        button.setAttribute("data-fact-a", i);
                        button.setAttribute("data-fact-b", j);
                        button.addEventListener("click",() => {
                            button.classList.toggle("selected");
                            updateClearButton();
                            //Select the commutative one (if not a square)
                            const commutativeButton = document.querySelector(`button[data-fact-a="${j}"][data-fact-b="${i}"]`);
                            if (commutativeButton && i !== j) commutativeButton.classList.toggle("selected");
                        });
                        gridContainer.appendChild(button);
                    }
                updateClearButton();
                refreshCustomPresetButtons();
            </script>
        </div>
        <p><button id="startGame" onclick="start();">Start Game</button></p>
        <p>Tips:</p>
        <ul class="tips">
            <li>Type <span>numbers</span> to complete the problems</li>
            <li>Press <span>Enter</span> to submit your answer</li>
            <li>Answering incorrectly will make the problem speed up!</li>
            <li>Game over when the problem touches the bottom of the screen</li>
            <li>Press <span>Backspace</span> to erase</li>
            <li>Press <span>Spacebar</span> to pause</li>
            <li>Press <span>Escape</span> to quit</li>
            <li>Press <span>Left</span> or <span>Right</span> to target a different problem</li>
            <li>Press <span>`</span> or <span>~</span> under the Escape key to toggle stats display</li>
            <li><span>1</span> point for every problem solved.</li>
            <li><span>4</span> extra points if you clear the screen.</li>
            <li><span>8</span> extra points if you clear the screen soon after the last clear.</li>
            <li>The game gets harder the more points you score!  Can you beat <span>100</span>?</span>></li>
        </ul>

        <p>Coming Soon:</p>
        <ul class="tips">
            <li>Remember high scores</li>
            <li>More visual splash</li>
            <li>More creative gameplay</li>
        </ul>
    </div>

    <div id="gameContainer" style="display: none;">
        <div class="score">Score: <span id="score">0</span></div>
        <div id="tipContainer"></div>
        <div class="decoration">
            <div class="laserContainer" id="laserContainer">
                <svg id="svgLaser">
                    <defs>
                        <radialGradient id="laserGrad" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                            <stop offset="0%" style="stop-color:yellow;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:yellow;stop-opacity:0" />
                        </radialGradient>
                    </defs>
                    <g id="g" />
                </svg>
            </div>
            <div class="turret" id="turret">
                <svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <clipPath id="myClip">
                            <ellipse cx="50" cy="50" rx="50" ry="50" id="svg_2"/>
                        </clipPath>
                        <radialGradient cy="0.36406" cx="0.42969" spreadMethod="pad" id="svg_8">
                            <stop offset="0" stop-color="#3f7f00"/>
                            <stop offset="1" stop-opacity="0.99609" stop-color="#2b5600"/>
                        </radialGradient>
                        <!-- The filter region is expanded to accommodate the large shadow -->
                        <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                            <feDropShadow dx="0" dy="0" stdDeviation="100" flood-color="#000000" flood-opacity="0.9"/>
                        </filter>
                    </defs>
                    <g clip-path="url(#myClip)" filter="url(#shadow)">
                        <g filter="url(#svg_1_blur)" id="svg_1">
                            <ellipse fill="url(#svg_8)" cx="50" cy="50" id="ball" rx="50" ry="50"/>
                        </g>
                        <path id="svg_4" d="m10.75,81c2.5,-27.75 43.25,-73 64.75,-74c21.5,-1 42.25,2.25 9.75,7c-32.5,4.75 -58,59.25 -61.25,78.5c-3.25,19.25 -15.75,16.25 -13.25,-11.5z" opacity="NaN" fill="#000000"/>
                        <path id="svg_6" d="m93.30566,79.5c-2.78931,-27.75 -48.25498,-73 -72.24301,-74c-23.98803,-1 -47.13926,2.25 -10.87829,7c36.26097,4.75 64.71189,59.25 68.33798,78.5c3.6261,19.25 17.57262,16.25 14.78332,-11.5z" opacity="NaN" fill="#000000"/>
                    </g>
                </svg>
            </div>
        </div>
        <div class="background">&#215;</div>
        <div class="background2"></div>
        <div id="statsContainer">
        </div>
    </div>

    <div id="gameOver" style="display: none;">
        <h1>Game Over</h1>
        <p>Your score: <span id="score2"></span></p>
        <button id="playAgain" onclick="location.reload();">Play Again</button>
    </div>

    <div id="paused" style="display: none;">
        <p>Paused</p>
        <p>Press spacebar to continue</p>
        <p>Score: <span id="pauseScore"></span></p>
    </div>
    
    <div id="templates" style="display: none;">
        <div id="vaderTemplate" class="vader">
            <table>
                <tr><td class="factA" colspan="2"></td></tr>
                <tr><td class="operator">&#215;</td><td class="factB"></td></tr>
                <tr><td class="result" colspan="2">&nbsp;</td></tr>
            </table>
        </div>
    </div>

    <audio src="calm-soft-background-music-357212.mp3" id="gameMusic" loop></audio>
</body>
</html>